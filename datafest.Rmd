---
title: "Datafest"
author: "Lauren and Kwan"
date: "3/24/2017"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.


## Reading in Data & Merging destination data with 1% of (US) data 

```{r pressure, echo=FALSE}
library(ggplot2)
dest <- read.table('data/dest.txt', sep="\t", header = T, quote = "")
us_sample <- read.table('data/us.data.1.percent.tsv', sep="\t", header = T, quote = "")
data_sample <- read.table('data/data.1.percent.txt', sep="\t", header = T, quote = "")
merged_data <- merge(dest, data_sample, by = 'srch_destination_id')
merged_US <- merge(dest, us_sample, by = 'srch_destination_id')
```

## Heatmap of popular travel activities 
```{r pressure, echo=FALSE}
library(ggplot2)
popular = as.matrix(dest[,7:dim(dest)[2]])
rnames <- dest$srch_destination_name
rownames(popular) <- rnames

Dest_hm <- heatmap(popular[0:10,0:4], Rowv = NA, Colv = NA, col = cm.colors(250), 
                   scale = "column")
```
## Correlation between frequency of user location and frequency of hotel location
```{r pressure, echo=FALSE}

```
Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

## Number of clicks and bookings per user 
```{r pressure, echo=FALSE}

books <- merged_data[merged_data$is_booking == 1,]
num_bookings <- aggregate(data.frame(count = books$is_booking), list(value = books$user_id), length)

ggplot(num_bookings, aes(count)) + geom_bar() + ggtitle("Bookings per user Histogram")

clicks <- merged_data[merged_data$is_booking == 0,]
us_clicks <- merged_US[merged_US$is_booking == 0,]

num_clicks <- aggregate(data.frame(count = clicks$is_booking), list(value = clicks$user_id), length)
ggplot(num_clicks, aes(count)) + geom_bar() + ggtitle("Clicks per user Histogram")

```
## Look for couples vs. family trips that were booked 
```{r pressure, echo=FALSE}

couples <- subset(books, books$srch_adults_cnt == 2)
families <- subset(books, books$srch_children_cnt >= 1)
ggplot(data = couples, aes(hist_price_band, group = factor(hist_price_band))) + geom_density() + ggtitle("Price bands for couples")

ggplot(data = families, aes(hist_price_band, group = factor(hist_price_band))) + geom_density() + ggtitle("Price bands for families")

mean(couples$orig_destination_distance)

```
## Destinations that were not booked outside US: what are interesting features? 
```{r pressure, echo=FALSE}
s<- subset(clicks, !duplicated(clicks$srch_destination_id))
s1 <- subset(s, s$hotel_country != "UNITED STATES OF AMERICA")
length(s)
popular_not_booked = as.matrix((s1[,7:10]))
rnames <- s1$srch_destination_name
# maybe plot these on a map? 
rownames(popular_not_booked) <- rnames

dest_not_booked_hm <- heatmap(popular_not_booked[1:3,], Rowv = NA, Colv = NA, col = cm.colors(250), scale = "column")


```